<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VibeCheck - AI Streetwear</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      font-size: 32px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .status {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      margin-bottom: 20px;
    }
    .status.success { background: #d4edda; color: #155724; }
    .status.error { background: #f8d7da; color: #721c24; }
    .status.info { background: #d1ecf1; color: #0c5460; }
    input, button {
      width: 100%;
      padding: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      transition: transform 0.2s;
    }
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover { transform: translateY(-2px); }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .api-status {
      text-align: center;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-top: 20px;
      font-size: 12px;
    }
    .section { margin: 20px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üî• VibeCheck</h1>
    <p class="subtitle">AI-Powered Streetwear Auth</p>
    
    <div id="status" class="status" style="display:none;"></div>
    
    <div id="phoneSection" class="section">
      <input type="tel" id="phone" placeholder="Enter 10-digit mobile" maxlength="10" pattern="[0-9]{10}" />
      <button id="sendOtpBtn" onclick="sendOTP()">Send OTP</button>
    </div>
    
    <div id="otpSection" class="section" style="display:none;">
      <input type="text" id="otp" placeholder="Enter 6-digit OTP" maxlength="6" pattern="[0-9]{6}" />
      <button id="verifyOtpBtn" onclick="verifyOTP()">Verify OTP</button>
    </div>
    
    <div class="api-status">
      Backend: <span id="apiStatus">‚è≥ Checking...</span>
    </div>
  </div>

  <script>
    const API_URL = 'https://vibecheck-production.onrender.com';
    let phone = '';

    // Check API Status
    async function checkAPIStatus() {
      try {
        const res = await fetch(API_URL + '/');
        if (res.ok) {
          document.getElementById('apiStatus').textContent = '‚úÖ Connected';
        } else {
          document.getElementById('apiStatus').textContent = '‚ö†Ô∏è Not Ready';
        }
      } catch (err) {
        document.getElementById('apiStatus').textContent = '‚ùå Offline';
      }
    }

    function showStatus(message, type = 'info') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status ${type}`;
      status.style.display = 'block';
    }

    async function sendOTP() {
      phone = document.getElementById('phone').value.trim();
      
      if (!phone || !/^\d{10}$/.test(phone)) {
        showStatus('Please enter a valid 10-digit phone number', 'error');
        return;
      }

      const btn = document.getElementById('sendOtpBtn');
      btn.disabled = true;
      btn.textContent = 'Sending...';

      try {
        const res = await fetch(API_URL + '/api/send-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone })
        });

        const data = await res.json();

        if (res.ok && data.success) {
          showStatus('OTP sent successfully! Check your SMS', 'success');
          document.getElementById('phoneSection').style.display = 'none';
          document.getElementById('otpSection').style.display = 'block';
          document.getElementById('otp').focus();
        } else {
          showStatus(data.error || 'Failed to send OTP', 'error');
        }
      } catch (err) {
        console.error('Error:', err);
        showStatus('Network error. Please try again.', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Send OTP';
      }
    }

    async function verifyOTP() {
      const otp = document.getElementById('otp').value.trim();
      
      if (!otp || !/^\d{6}$/.test(otp)) {
        showStatus('Please enter a valid 6-digit OTP', 'error');
        return;
      }

      const btn = document.getElementById('verifyOtpBtn');
      btn.disabled = true;
      btn.textContent = 'Verifying...';

      try {
        const res = await fetch(API_URL + '/api/verify-otp', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ phone, otp })
        });

        const data = await res.json();

        if (res.ok && data.success) {
          showStatus('‚úÖ Phone verified successfully!', 'success');
          localStorage.setItem('sessionToken', data.token);
          setTimeout(() => {
            window.location.href = '/';
          }, 2000);
        } else {
          const remaining = data.attemptsRemaining;
          const msg = remaining !== undefined ? `Invalid OTP. ${remaining} attempts remaining.` : data.error;
          showStatus(msg || 'Verification failed', 'error');
        }
      } catch (err) {
        console.error('Error:', err);
        showStatus('Network error. Please try again.', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Verify OTP';
      }
    }

    // Allow Enter key
    document.getElementById('phone').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendOTP();
    });
    document.getElementById('otp').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') verifyOTP();
    });

    // Check API on load
    checkAPIStatus();
    setInterval(checkAPIStatus, 10000);
  </script>
</body>
</html>
